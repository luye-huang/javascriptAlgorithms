<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
    // 93
    //    var restoreIpAddresses = function (s) {
    //        const res = [], indexes = [];
    //        split(s, 4, [], indexes);
    //        indexes.forEach((v) => {
    //            const ip = [];
    //            let left = 0;
    //            for (let i = 0; i < v.length; i++) {
    //                ip.push(s.substr(left, v[i]));
    //                left += v[i];
    //            }
    //            res.push(ip.join('.'));
    //        });
    //        return res;
    //    };
    //
    //    var split = function (s, level) {
    //        const array = arguments[2] ? arguments[2] : [];
    //        const res = arguments[3] ? arguments[3] : [];
    //        if (level == 1) {
    //            const num = Number.parseInt(s);
    //            //防止0开头 (num + '').length == s.length
    //            if (num < 256 && (num + '').length == s.length) {
    //                array.push(s.length);
    //                const path = [...array];
    //                res.push(path);
    //                array.pop();
    //            }
    //        } else {
    //            for (let i = 1; i < 4; i++) {
    //                const num = Number.parseInt(s.substr(0, i));
    //                if (num < 256 && s.length - i <= (level - 1) * 3 && (num + '').length == i) {
    //                    array.push(i);
    //                    arguments.callee(s.substr(i), level - 1, array, res);
    //                    array.pop();
    //                }
    //            }
    //        }
    //    }
    //
    //    console.log(restoreIpAddresses("010010"));

    /**
     * @param {number[]} nums
     * @return {boolean}
     */
            //    473
    var makesquare = function (nums) {

            };
    /**
     * 316
     * @param {string} s
     * @return {string}
     */
    var removeDuplicateLetters = function (s) {
        let result = '';
        const len = s.length;
        const chars = Array.from(s).map(c=>c.charCodeAt());
        let dict = new Map();
        for (let i = 0; i < len; i++) {
            const c = chars[i];
            const idx = dict.get(c);
            if (idx !== undefined) {
                idx.push(i);
                dict.set(c, idx);
            } else {
                dict.set(c, [i]);
            }
        }
        let duplicates = [...dict.entries()].sort((a, b) => a[0] - b[0]);
        const toRemove = duplicates.map(d=> d[0]);
        duplicates = duplicates.filter(d=> d[1].length > 1).map(d=> d[0]);
        const keep = [];
        removeImp(toRemove, keep, duplicates, dict, chars);
        for (let i = 0; i < chars.length; i++) {
            const cr = chars[i];
            if (cr !== 1000) {
                result += String.fromCharCode(cr);
            }
        }
        return result;
    };

    const removeImp = function (toRemove, keep, duplicates, dict, chars) {
        while (toRemove.length) {
            const cur = toRemove.shift();
            let indexKeep = 0;
            const positions = dict.get(cur);
            const lenPos = positions.length;
            if (duplicates.includes(cur)) {
                let prev = 0, current = 1;
                //问题在这 清明回来做
                for (; current < lenPos;) {
                    if (chars.slice(positions[prev], positions[current]).find(c=>c < cur)) {
                        prev++;
                    }
                    current++;
                }
                if (chars.slice(positions[prev], positions[current - 1]).find(c=>c < cur)) {
                    indexKeep = current - 1;
                } else {
                    indexKeep = prev;
                }
                keep.push([cur, positions[indexKeep]]);
                for (let i = 0; i < lenPos; i++) {
                    if (i == indexKeep) {
                        chars[positions[i]] = cur;
                    } else {
                        chars[positions[i]] = 1000;
                    }
                }
            }
            const bt = [];
            for (let i = 0; i < keep.length;) {
                if (keep[i][1] > positions[indexKeep]) {
//                    toRemove.splice(0, 0, keep[i][0]);
                    bt.push(keep[i][0]);
                    keep.splice(i, 1);
                } else {
                    i++;
                }
            }
            toRemove = toRemove.concat(bt);
        }
    };
    //    console.log(removeDuplicateLetters("bcabc"));
    console.log(removeDuplicateLetters("cbacdcbc"));

</script>
</body>
</html>