<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HEAP</title>
</head>
<body>
<script>
    (function () {
        function Heap(array) {
            this.array = [];
            this.index = [];
            array.forEach((item)=>this.insert(item));
        }

        Heap.prototype = {
            _shiftDown: function (index) {
                while (index < this.size()) {
                    let childIndex = 2 * index + 1;
                    if (childIndex + 1 < this.size() - 1 && this.array[childIndex] < this.array[childIndex + 1]) {
                        childIndex++;
                    }
                    if (this.array[index] < this.array[childIndex]) {
                        [this.array[index], this.array[childIndex]] = this._swap(this.array[index], this.array[childIndex]);
                        index = childIndex;
                    }
                    else {
                        break;
                    }
                }
            },
            _shiftUp: function (index) {
                while (index > 0) {
                    let parentIndex = Math.floor((index - 1) / 2);
                    if (this.array[index] > this.array[parentIndex]) {
                        [this.array[index], this.array[parentIndex]] = this._swap(this.array[index], this.array[parentIndex]);
                    }
                    index = parentIndex;
                }
            },
            _swap: function (a, b) {
                return [b, a];
            },
            value: function () {
                return this.array;
            },
            pop: function () {
                const result = this.array[0];
                [this.array[0], this.array[this.size() - 1]] = this._swap(this.array[0], this.array[this.size() - 1]);
                this.array.pop();
                this._shiftDown(0);
                return result;
            },
            insert: function (item) {
                this.array.push(item);
                this._shiftUp(this.size() - 1);
            },
            size: function () {
                return this.array.length;
            }
        }
        window.Heap = Heap;
    })();
    /** 767
     * @param {string} S
     * @return {string}
     */
    var reorganizeString = function (S) {
        const heap = new MyHeap(Array.from(S));
        let ret = '', cur = 'null';
        if (!S.length || heap.peek().value > Math.ceil(S.length / 2)) {
            return '';
        }
        while (heap.peek() && (heap.peek().value > 1 || heap.peek().key == cur)) {
            const {key, idx} = heap.sort(cur);
            heap.decrease(idx);
            cur = key;
            ret += cur;
        }
        return ret + heap.stringfy();
    };
    function MyHeap(list) {
        this.list = [];
        list.forEach(a=>this.push(a));
    }
    MyHeap.prototype.push = function (char) {
        const idx = this.list.findIndex(a=>a.key == char);
        if (idx == -1) {
            this.list.push({key: char, value: 1});
        } else {
            this.list[idx].value++;
            this.refreshInc(idx);
        }
    };
    MyHeap.prototype.peek = function () {
        return this.list[0];
    };
    MyHeap.prototype.refreshInc = function (idx) {
        while (idx > 0) {
            if (this.list[idx].value > this.list[idx - 1].value) {
                [this.list[idx - 1].value, this.list[idx].value] = [this.list[idx].value, this.list[idx - 1].value];
                [this.list[idx - 1].key, this.list[idx].key] = [this.list[idx].key, this.list[idx - 1].key];
                idx--;
            } else {
                break;
            }
        }
    };
    MyHeap.prototype.sort = function (char) {
        let idx = this.list.findIndex(a=> a.key != char);
        idx = idx == -1 ? 0 : idx;
        return Object.assign(this.list[idx], {idx: idx});
    };
    MyHeap.prototype.decrease = function (idx) {
        if (this.list[idx].value > 1) {
            this.list[idx].value--;
            this.refreshDec(idx);
        } else {
            this.list.splice(idx, 1);
        }
    };
    MyHeap.prototype.refreshDec = function (idx) {
        while (idx < this.list.length - 1) {
            if (this.list[idx].value < this.list[idx + 1].value) {
                [this.list[idx + 1].value, this.list[idx].value] = [this.list[idx].value, this.list[idx + 1].value];
                [this.list[idx + 1].key, this.list[idx].key] = [this.list[idx].key, this.list[idx + 1].key];
                idx++;
            } else {
                break;
            }
        }
    };
    MyHeap.prototype.stringfy = function () {
        return this.list.map(a=>a.key).join('');
    };
    //    console.log(reorganizeString('aaab'));
    console.log(reorganizeString("eqmeyggvp"));
    console.log(reorganizeString("abbabbaaab"));
</script>
</body>
</html>